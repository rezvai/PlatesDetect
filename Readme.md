# Файловая структура

<hr>

## Папки:
- solution - папка, содержащая в себе файлы решения поставленной задачи.
- al-ctype-1/2/3/4 - папки, содержащие в себе объединенные фото сгенерированных и реальных номеров.
- models - папка, содержащая в себе все этапы разработки детекции номеров.
- datasets - папка, содержащая в себе все структурированные датасеты для моделей.
- data - папка, содержащая в себе объединенные реальные фото, а также разметку к фото(obj_train_data: файлы формата .txt).
- detect\runs - папки, содержащие в себе этапы обучения модели: графики, метрики и расчеты.
- weights - папка с весами модели.

## Файлы:
* links.json - JSON(JavaScript Object Notation) файл со спаршенными ссылками на карточки с информацией об автомобилях с сайта platesmania.com, раздела Албании.
* noWay.png - не принятое предложение о покупке API для сбора данных с сайта platesmania.com
* parse_data.ipynb - парсинг и скрейпинг данных с сайта platesmania.com
* al-ctype-1\2\3\4_meta.json - JSON файлы, содержащие всю мету информацию с карточек автомобилей.
* preprocess_data.ipynb - файл, содержащий в себе предобработку данных для дальнейшего обучения моделей.
* data.yaml - конфигурационные файлы для указания основных параметров для обучения моделей.
* model_ctype1/2/3/4/all_ctypes.iypnb - файл, содержащий в себе реализацию обучения модели и ее применения.
* best.pt - лучшие веса во время обучения модели.
* last.pt - последние веса обученной модели.
* results.csv - результаты(метрики) обучения относительно эпох.
* yolov10n.pt - веса предобученной модели YOLO 10-й версии размера nano.
* yolov9t.pt - веса предобученной модели YOLO 9-й версии размера tiny.


<hr>

### Объяснения выбранного алгоритма обучения 

#### Алгоритмы, на которые пал выбор и их краткое описание работы: 

##### <strong>Faster R-CNN(Region-base Convulutional Neural Networks)</strong> - работает в два этапа. На первом этапе предлагает регионы интереса(ROI), на втором этапе затем классифицирует каждый регион и уточняет Bouding Box. 

<strong>Минусы:</strong>

- Медленная работа алгоритма.

- Трудность реализации относительно выбранного алгоритма.

<strong>Плюсы:</strong>

- Высокая точность детекции, особенно мелких объектов.

##### <strong>SSD(Single Shot MultiBox Detector)</strong> - работает в один шаг. Исользуя многоуровневые карты признаков для разных масштабов объектов.

<strong>Минусы:</strong>

- Уступает по точности Faster R-CNN(не критично, потому что данный алгоритм имеет одну из лучших точностей), а также YOLO(критично, потому что данный алгоритм проще в реализации, а также он работает быстрее).

<strong>Плюсы:</strong>
Описывая минусы, думаю стоит забыть о плюсах.

##### <strong>RetinaNet</strong> - работает в один этап. К полученному результату применяет Focal Loss(функция потерь для несбалансированных классов), тем самым улучшает детекцию малых объектов.

<strong>Минусы:</strong>

- Скорость чуть выше, чем у Faster R-CNN.

- У данного алгоритма высокая точность для сложных задач с дизболансом классов, поставленная же задача не имеет дисбаланса классов(он всего 1).

<strong>Плюсы:</strong>

- В минусах был упомянут дисбаланс классов, в этом и заключается плюс алгоритма - алгоритм показывает высокую точность при решение сложных задач с дисбалансом классов.

##### <strong>YOLO(You Only Look Once)</strong> - работает в один этап. Разделяет изображение на сетку, предсказывая Bounding Box и класс для каждого сегмента.

<strong>Минусы:</strong>

- Имеет не самую лучшую среди вышеописанных моделей для мелких объектов.

<strong>Плюсы:</strong>

- Прост в реализации, а также имеет большое комьюнити.

- Является самым быстрым среди описанных алгоритмов, при этом не критично теряет показатель точности детекции.

<br>
<img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/e46/1ff/047/e461ff0478045f00fbc1622bfb931e37.png">

<hr>

#### Подробное объяснения выбранного алгоритма:

Познакомившись с алгоритмом YOLO, особенно с ее реализацией от библиотеки ultralytics, было понятно, что это очень удобно решение и не нужно накручивать на модель множество гипермараметров для получения нормального результата. С момента моего последнего пользования данны алгоритмом появилось две новые версии: v9, v10. А вот что улучшилось:

<img src="https://cdn-images-1.readmedium.com/v2/resize:fit:800/0*jnDFJ5N-oU-46vl0.png">

Скорость работы v9 версии стала лучше на 10%, а скорость v10 стала лучше на 25% относительно v8. Да, модель может похвастаться скоростью своей работы, но при этом качество детекции также качественное. maP(Mean Average Precision) модели v10 увеличилась почти на 4% относительно более старой версии v8 и составляет 45.6%.

Также в аргумент моим словам хочется привести статью на Habr`e от <a href="https://habr.com/ru/articles/594401/#:~:text=%D0%B8%20%D0%BF%D0%BE%D1%82%D1%80%D0%B5%D0%B1%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5%20%D0%B2%D0%B8%D0%B4%D0%B5%D0%BE%D0%BF%D0%B0%D0%BC%D1%8F%D1%82%D0%B8.-,%D0%9E%D0%BF%D1%82%D0%B8%D0%BC%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F%3A%20%D0%AD%D1%82%D0%B0%D0%BF%203,-%D0%9D%D0%B0%20%D0%BC%D0%BE%D0%BC%D0%B5%D0%BD%D1%82%20%D0%BF%D0%B5%D1%80%D0%B5%D1%85%D0%BE%D0%B4%D0%B0">Nomeroff</a>.

В данной статье описывается как сервис проводил оптимизацию работы модели детекции номеров. Исходя из того, что они специализируются на данной сфере и пытаются улучшить свои алгоритмы для более лучшей работы своего сервиса, можно сделать вывод, что YOLO отлично подходит для данной задачи.

Приступим к моим результатам, у меня было несколько идей:

1. Исходя из того, что номера оказались достаточно разные в некоторых категориях, изначально было спланировано обучить по модели на каждую категорию, но модели показали не удовлетворительный результат на разных версихя YOLO(v8n, v9t, v9s, v10n), у некоторых категорий были плохие метрики на выходе. Для версии v10n просто на просто не хватило количества данных в категории ctype=2. 

2. Попробовав обучить по модели на каждую категорию, получив не удовлетворяющий результат, было принято решение объединить все данные в один датасет, увеличить количество эпох, воспользовавшись версией алгоритма v10n. В результате данной версии хватило количества данных и с течением эпох метрики по-немногу повышались, а на выхрде получился отличный результат. 

3. На запасной вариант, если общая модель с объединенными сетами показала бы плохой резульатат для детекции каких-либо категорий: мной было решенно заново воспользоваться моделями для каждой категории, но вернемся к нехватки данных, так как там номера из албании и некоторые номера старого поколения, само собой вручную нафоткать их не получится, было принято решение воспользоваться аугментацией, например готовыми решениями от <a href="https://www.tensorflow.org/tutorials/images/data_augmentation?hl=ru">TensorFlow</a>. Но данный вариант не пригодился.

4. Также на крайний случай плохой работы YOLO, мной было рассмотренно решение смены алгоритма на Faster RCNN. Например воспользовавшись <a href="https://developers.arcgis.com/python/guide/faster-rcnn-object-detector/">API</a> или решением от <a href="https://pytorch.org/vision/stable/models/faster_rcnn.html">PyTorch</a>.

<hr>

### Источники
1. <a href="https://habr.com/ru/articles/709432/">Таблица, описывающая mAP между моделями YOLO и Region-based CNN</a>

2. <a href="https://readmedium.com/yolov10-vs-yolov9-vs-yolov8-8a3c3d596b6f">Графы, отображающие скорость работы и mAP между моделями YOLO.</a>

3. <a href="https://habr.com/ru/articles/594401/">Статья от Nomeroff</a>

4. <a href="https://www.tensorflow.org/tutorials/images/data_augmentation?hl=ru">Аугментация данных от TensorFlow</a>

5. <a href="https://developers.arcgis.com/python/guide/faster-rcnn-object-detector/">API для реализации Faster R-CNN</a>

6. <a href="https://pytorch.org/vision/stable/models/faster_rcnn.html">Реализация Faster R-CNN от PyTorch</a>

<hr>

###### Date: 03.07.2024 - 08.07.2024
###### Author: Rabov.A.A

